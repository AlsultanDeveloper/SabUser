# ุฅูุดุงุก ูุซููุฉ ุงูุฅุนุฏุงุฏุงุช ูู Firebase

## ุงููุดููุฉ ุงูุญุงููุฉ

```
WARN  โ๏ธ Could not load settings from Firebase, using defaults: Missing or insufficient permissions.
```

**ุงูุชูุถูุญ:** ูุฐู **ููุณุช ูุดููุฉ ุฎุทูุฑุฉ** - ุงูุชุทุจูู ูุนูู ุจุดูู ุตุญูุญ ุจุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ. ููู ูู ุงูุฃูุถู ุฅูุดุงุก ูุซููุฉ ุงูุฅุนุฏุงุฏุงุช ูู Firebase ูุชุณููู ุฅุฏุงุฑุชูุง.

## ุงูุญู ุงูุณุฑูุน

### ุงูุทุฑููุฉ 1: ุจุงุณุชุฎุฏุงู ุงูุณูุฑูุจุช (ููุตู ุจูุง)

```powershell
# ูู ูุฌูุฏ ุงููุดุฑูุน
node scripts/initSettings.js
```

ูุฐุง ุณููุดุฆ ูุซููุฉ `settings/app` ูู Firestore ูุน ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ.

### ุงูุทุฑููุฉ 2: ูุฏููุงู ูู Firebase Console

1. ุงูุชุญ [Firebase Console](https://console.firebase.google.com/project/sab-store-9b947/firestore)
2. ุงุฐูุจ ุฅูู **Firestore Database**
3. ุงููุฑ ุนูู **Start collection**
4. ุงุณู ุงููุฌููุนุฉ: `settings`
5. ูุนุฑู ุงููุซููุฉ: `app`
6. ุฃุถู ุงูุญููู ุงูุชุงููุฉ:

```json
{
  "shipping": {
    "cost": 15,
    "freeShippingThreshold": 100,
    "currency": "SAR",
    "enabled": true
  },
  "currency": {
    "default": "SAR",
    "supported": ["SAR", "USD", "AED"],
    "usdToLbp": 89700
  },
  "tax": {
    "enabled": false,
    "rate": 0,
    "includeInPrice": false
  },
  "orderSettings": {
    "minOrderAmount": 0,
    "maxOrderAmount": 10000
  },
  "app": {
    "maintenanceMode": false,
    "version": "1.0.0",
    "forceUpdate": false,
    "features": {
      "cart": true,
      "wishlist": true,
      "notifications": true,
      "gps": true
    }
  },
  "payments": {
    "cashOnDelivery": true,
    "card": false,
    "wallet": false
  }
}
```

## ุงูุชุญูู ูู ุงูุญู

ุจุนุฏ ุฅูุดุงุก ุงููุซููุฉุ ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู:

```powershell
npx expo start --clear
```

ูุฌุจ ุฃู ุชุฑู ูู ุงูุณุฌูุงุช:

```
โ Settings loaded from Firebase: {...}
```

ุจุฏูุงู ูู:

```
โ๏ธ Could not load settings from Firebase, using defaults
```

## ููุงุญุธุงุช ูููุฉ

### 1. ุงูุชุทุจูู ูุนูู ุจุดูู ุตุญูุญ ุญุชู ุจุฏูู ูุซููุฉ ุงูุฅุนุฏุงุฏุงุช
ุงูููุฏ ูู `hooks/useSettings.ts` ูุชุนุงูู ูุน ูุฐุง ุจุดูู ุฐูู:
- ุฅุฐุง ูู ุชูู ุงููุซููุฉ ููุฌูุฏุฉ โ ูุณุชุฎุฏู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ
- ุฅุฐุง ูุงูุช ููุฌูุฏุฉ โ ูุณุชุฎุฏู ุงูููู ูู Firebase

### 2. ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ุงููุณุชุฎุฏูุฉ

```typescript
{
  shipping: {
    cost: 15,                    // ุชูููุฉ ุงูุดุญู: 15 ุฑูุงู
    freeShippingThreshold: 100,  // ุดุญู ูุฌุงูู ููู 100 ุฑูุงู
    currency: 'SAR',
    enabled: true
  },
  currency: {
    default: 'SAR',
    supported: ['SAR', 'USD', 'AED'],
    usdToLbp: 89700  // 1 ุฏููุงุฑ = 89,700 ููุฑุฉ ูุจูุงููุฉ
  }
}
```

### 3. ููุงุฆุฏ ุฅูุดุงุก ูุซููุฉ ุงูุฅุนุฏุงุฏุงุช

โ **ุฅุฏุงุฑุฉ ูุฑูุฒูุฉ:** ููููู ุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช ูู Firebase Console  
โ **ุชุญุฏูุซุงุช ููุฑูุฉ:** ุงูุชุบููุฑุงุช ุชุธูุฑ ูู ุงูุชุทุจูู ููุฑุงู (real-time)  
โ **ุณูููุฉ ุงูุตูุงูุฉ:** ูุง ุญุงุฌุฉ ูุชุญุฏูุซ ุงูููุฏ ูุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช  
โ **ุงุฎุชุจุงุฑ A/B:** ููููู ุชุฌุฑุจุฉ ุฅุนุฏุงุฏุงุช ูุฎุชููุฉ  

## ุงูุฅุนุฏุงุฏุงุช ุงููุงุจูุฉ ููุชุฎุตูุต

### ุชูุงููู ุงูุดุญู
```javascript
shipping: {
  cost: 15,                    // ุชูููุฉ ุงูุดุญู ุงูุงูุชุฑุงุถูุฉ
  freeShippingThreshold: 100,  // ุงูุญุฏ ุงูุฃุฏูู ููุดุญู ุงููุฌุงูู
  currency: 'SAR',
  enabled: true                // ุชูุนูู/ุชุนุทูู ุงูุดุญู
}
```

### ุณุนุฑ ุงูุตุฑู
```javascript
currency: {
  usdToLbp: 89700  // ููููู ุชุญุฏูุซู ุจุงูุชุธุงู
}
```

ูุชุญุฏูุซ ุณุนุฑ ุงูุตุฑู ุชููุงุฆูุงูุ ุงุณุชุฎุฏู:
```powershell
node scripts/update-exchange-rate.js
```

### ูุถุน ุงูุตูุงูุฉ
```javascript
app: {
  maintenanceMode: false,  // true ูุชูุนูู ูุถุน ุงูุตูุงูุฉ
  version: "1.0.0",
  forceUpdate: false       // true ูุฅุฌุจุงุฑ ุงููุณุชุฎุฏููู ุนูู ุงูุชุญุฏูุซ
}
```

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงูุฎุทุฃ: "Missing or insufficient permissions"

**ุงูุณุจุจ:** ูุซููุฉ `settings/app` ุบูุฑ ููุฌูุฏุฉ  
**ุงูุญู:** ุงุณุชุฎุฏู ุฃุญุฏ ุงูุทุฑููุชูู ุฃุนูุงู ูุฅูุดุงุฆูุง

### ุงูุฎุทุฃ ูุง ูุฒุงู ููุฌูุฏุงู ุจุนุฏ ุฅูุดุงุก ุงููุซููุฉ

1. **ุชุฃูุฏ ูู ุงุณู ุงููุซููุฉ:**
   - ูุฌุจ ุฃู ุชููู: `settings/app`
   - ูููุณ `settings/settings` ุฃู ุบูุฑู

2. **ุชุญูู ูู ุงูููุงุนุฏ:**
   ```javascript
   // ูู firestore.rules
   match /settings/{document} {
     allow read: if true;  // ูุฌุจ ุฃู ุชููู ููุฌูุฏุฉ
   }
   ```

3. **ุฃุนุฏ ูุดุฑ ุงูููุงุนุฏ:**
   ```powershell
   firebase deploy --only firestore:rules
   ```

4. **ุงูุณุญ ุงูู cache:**
   ```powershell
   npx expo start --clear
   ```

## ุงูุฎูุงุตุฉ

- โ๏ธ ุงูุชุญุฐูุฑ ุงูุญุงูู **ููุณ ุฎุทุฃ** - ุงูุชุทุจูู ูุนูู ุจุดูู ุตุญูุญ
- โ ุฅูุดุงุก ูุซููุฉ ุงูุฅุนุฏุงุฏุงุช ูุญุณู ุฅุฏุงุฑุฉ ุงูุชุทุจูู
- ๐ง ุงุณุชุฎุฏู `node scripts/initSettings.js` ููุฅูุดุงุก ุงูุณุฑูุน
- ๐ ููููู ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช ูู Firebase Console ูุจุงุดุฑุฉ
