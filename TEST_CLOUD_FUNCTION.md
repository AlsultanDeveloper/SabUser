# ุงุฎุชุจุงุฑ Cloud Function - ุฅุฑุณุงู ุฅุดุนุงุฑ ุฑุฏ ุงูุฏุนู
# Test Cloud Function - Support Reply Notification

## ุงูุฎุทูุงุช | Steps:

### 1๏ธโฃ ุงูุชุญ Firebase Console
ุชู ูุชุญ ุตูุญุฉ `supportMessages` ูู ุงููุชุตูุญ ุชููุงุฆูุงู!

ุฃู ุงูุชุญ ูุฏููุงู:
```
https://console.firebase.google.com/project/sab-store-9b947/firestore/databases/-default-/data/~2FsupportMessages
```

---

### 2๏ธโฃ ุงุฎุชุฑ ุฑุณุงูุฉ ุฏุนู ููุฑุฏ ุนูููุง

ูู ุตูุญุฉ Firestore:
1. ุณุชุฌุฏ ูุงุฆูุฉ ุจุฑุณุงุฆู ุงูุฏุนู
2. ุงุฎุชุฑ ุฃู ุฑุณุงูุฉ **ูููุง `userId`** (ููู!)
3. ุงุถุบุท ุนูููุง ููุชุญูุง

---

### 3๏ธโฃ ุฃุถู ุญูู ุงูุฑุฏ `reply`

ูู ุตูุญุฉ ุชูุงุตูู ุงูุฑุณุงูุฉ:

1. ุงุถุบุท ุนูู **"Add field"** ุฃู **"ุฅุถุงูุฉ ุญูู"**

2. ุงููุฃ ุงูุจูุงูุงุช:
   - **Field name:** `reply`
   - **Type:** `string`
   - **Value:** ุงูุชุจ ูุต ุงูุฑุฏ (ูุซุงู: "ุดูุฑุงู ูุชูุงุตูู! ุณูุญู ุงููุดููุฉ ุฎูุงู 24 ุณุงุนุฉ ๐")

3. ุงุถุบุท **"Save"** ุฃู **"ุญูุธ"**

---

### 4๏ธโฃ ุฑุงูุจ ุงูุณุฌูุงุช (Logs)

ุงูุชุญ Terminal ุฌุฏูุฏ ูุดุบู:

```powershell
firebase functions:log --only onSupportMessageReply
```

ุฃู ุงูุชุญ ูู ุงููุชุตูุญ:
```
https://console.firebase.google.com/project/sab-store-9b947/functions/logs
```

**ูุง ูุฌุจ ุฃู ุชุฑุงู ูู Logs:**
```
Support message updated: [messageId]
Notification sent successfully
โ Support reply notification sent successfully to user: [userId]
```

---

### 5๏ธโฃ ุชุญูู ูู ุงูุชุทุจูู ๐ฑ

ุนูู ุฌูุงุฒู (ุฃู ุงููุญุงูู):
- ูุฌุจ ุฃู ูุตูู ุฅุดุนุงุฑ ููุฑู! ๐ฑ
- ุงูุนููุงู: **"ุฑุฏ ูู ูุฑูู ุงูุฏุนู"**
- ุงููุญุชูู: ูุต ุงูุฑุฏ ุงูุฐู ูุชุจุชู

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก | Troubleshooting

### ุฅุฐุง ูู ูุตู ุงูุฅุดุนุงุฑ:

#### 1. ุชุญูู ูู Logs
```powershell
firebase functions:log
```

**ุงุจุญุซ ุนู:**
- โ `No userId found` โ ุงูุฑุณุงูุฉ ููุณ ูููุง userId
- โ `User not found` โ ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ
- โ `No push token` โ ุงููุณุชุฎุฏู ููุณ ูุฏูู pushToken

#### 2. ุชุญูู ูู pushToken ูู Firestore

ุงูุชุญ:
```
https://console.firebase.google.com/project/sab-store-9b947/firestore/databases/-default-/data/~2Fusers
```

ุงุจุญุซ ุนู ุงููุณุชุฎุฏู ูุชุฃูุฏ ูู ูุฌูุฏ ุญูู `pushToken` ุจูููุฉ ูุซู:
```
ExponentPushToken[xxxxxxxxxxxxxxxxxxxxxx]
```

#### 3. ุชุญูู ูู ุงูุฃุฐููุงุช (Permissions)

ูู ุงูุชุทุจููุ ุงุฐูุจ ุฅูู:
- ุงูุฅุนุฏุงุฏุงุช โ ุงูุฅุดุนุงุฑุงุช
- ุงุถุบุท ุฒุฑ **"ุฅุนุงุฏุฉ"** (Retry) ูุฅุนุงุฏุฉ ุทูุจ ุงูุฃุฐููุงุช
- ุงููุญ ุงูุชุทุจูู ุฅุฐู ุงูุฅุดุนุงุฑุงุช

---

## ๐ฏ ุงุฎุชุจุงุฑ ุณุฑูุน ุจุฏูู ุฑุณุงูุฉ ุญููููุฉ

ุฅุฐุง ูู ุชูู ููุงู ุฑุณุงุฆู ุฏุนูุ ููููู ุฅูุดุงุก ูุงุญุฏุฉ ุชุฌุฑูุจูุฉ:

### ูู Firebase Console:

1. ุงุฐูุจ ุฅูู `supportMessages`
2. ุงุถุบุท **"Add document"**
3. ุงููุฃ:
   ```
   Document ID: (auto-generated)
   
   Fields:
   - name: "ุงุฎุชุจุงุฑ"
   - phoneNumber: "+966500000000"
   - message: "ุฑุณุงูุฉ ุงุฎุชุจุงุฑ"
   - userId: "KATVNw7VXXPAwZauqsWh5Slubu42" (userId ุงูุฎุงุต ุจู)
   - status: "pending"
   - read: false
   - createdAt: (timestamp - ุงูุขู)
   ```
4. ุงุถุบุท **Save**

ุงูุขู:
5. ุงูุชุญ ุงูุฑุณุงูุฉ ูุฑุฉ ุฃุฎุฑู
6. ุฃุถู ุญูู `reply` ููุง ูู ุงูุฎุทูุฉ 3 ุฃุนูุงู
7. ุงูุชุธุฑ ุงูุฅุดุนุงุฑ! ๐

---

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ | Expected Result

โ **ุฅุฐุง ูุฌุญ ุงูุงุฎุชุจุงุฑ:**
- ูุตู ุฅุดุนุงุฑ ููุฑู ููุชุทุจูู
- ุชุธูุฑ ุฑุณุงูุฉ ูู Logs: "Notification sent successfully"
- ุงููุณุชุฎุฏู ููููู ูุชุญ ุงูุชุทุจูู ูุฑุคูุฉ ุงูุฑุฏ

โ **ุงูููุฒุงุช:**
- ุงูุฅุดุนุงุฑ ูุนูู ุญุชู ูู ูุงู ุงูุชุทุจูู ูุบูู
- ุงูุฏุงูุฉ ุชุนูู ุชููุงุฆูุงู ุจุฏูู ุฃู ููุฏ ุฅุถุงูู
- ูุง ุญุงุฌุฉ ูุงุณุชุฏุนุงุก API ูุฏููุงู

---

## ๐ ุจุนุฏ ูุฌุงุญ ุงูุงุฎุชุจุงุฑ

ุงูุขู ููููู:
1. ุงุณุชุฎุฏุงู Firebase Console ููุฑุฏ ุนูู ุฑุณุงุฆู ุงูุฏุนู
2. ุงูุฑุฏูุฏ ุณุชุฑุณู ุฅุดุนุงุฑุงุช ุชููุงุฆูุงู
3. ุงููุณุชุฎุฏููู ุณูุชูููู ุฅุดุนุงุฑุงุช ููุฑูุฉ

**ููุงุญุธุฉ:** ููููู ุฃูุถุงู ุฅูุดุงุก ููุญุฉ ุชุญูู ูุฎุตุตุฉ (Admin Panel) ุชุณุชุฎุฏู ููุณ ุงูุทุฑููุฉ:
- ุชุถูู ุญูู `reply` ูู Firestore
- ุงูุฏุงูุฉ ุงูุณุญุงุจูุฉ ุชุนูู ุชููุงุฆูุงู
- ูุง ุญุงุฌุฉ ูุงุณุชุฏุนุงุก ุฏุงูุฉ ุงูุฅุดุนุงุฑ ูุฏููุงู!

---

## ๐ ุฑูุงุจุท ูููุฏุฉ | Useful Links

- [Firebase Console - Firestore](https://console.firebase.google.com/project/sab-store-9b947/firestore)
- [Firebase Console - Functions Logs](https://console.firebase.google.com/project/sab-store-9b947/functions/logs)
- [Expo Push Notification Tool](https://expo.dev/notifications)

---

**ุฌุงูุฒ ููุงุฎุชุจุงุฑ! ๐**

ุงูุชุญ Firebase Console ุงูุขู ูุฌุฑุจ ุฅุถุงูุฉ ุฑุฏ ุนูู ุฃู ุฑุณุงูุฉ ุฏุนู!
