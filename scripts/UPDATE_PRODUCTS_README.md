# ๐ง ุชุญุฏูุซ ุงูููุชุฌุงุช ุงููุฏููุฉ - ุฅุถุงูุฉ subcategoryId

## ๐ ุงููุฏู

ูุฐุง ุงูุณูุฑูุจุช ูุณุงุนุฏ ูู ุชุญุฏูุซ ุงูููุชุฌุงุช ุงููุฏููุฉ ุงูุชู ูุฏููุง `subcategoryName` ููุทุ ูุฅุถุงูุฉ ุญูู `subcategoryId` ููุง.

## โ๏ธ ูุจู ุงูุจุฏุก

1. **ุฎุฐ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
   - ุงุฐูุจ ุฅูู Firebase Console
   - Cloud Firestore โ Import/Export
   - Export ุฌููุน ุงูุจูุงูุงุช

2. **ุชุฃูุฏ ูู ุฃู ูุฏูู ุตูุงุญูุงุช Admin**

## ๐ ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู Firebase Admin SDK (ููุตู ุจู)

### ุงูุฎุทูุฉ 1: ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ

```bash
npm install firebase-admin
```

### ุงูุฎุทูุฉ 2: ุงูุญุตูู ุนูู Service Account Key

1. ุงุฐูุจ ุฅูู [Firebase Console](https://console.firebase.google.com/)
2. ุงุฎุชุฑ ูุดุฑูุนู
3. Project Settings โ๏ธ
4. Service accounts
5. Generate new private key
6. ุงุญูุธ ุงูููู ูู ูุฌูุฏ `scripts/` ุจุงุณู `serviceAccountKey.json`

โ๏ธ **ููู**: ูุง ุชุฑูุน ูุฐุง ุงูููู ุนูู Git! ุชุฃูุฏ ูู ุฅุถุงูุชู ูู `.gitignore`

### ุงูุฎุทูุฉ 3: ุชุนุฏูู ุงูุณูุฑูุจุช

ุงูุชุญ ููู `scripts/update-products-with-subcategory-id.js` ููู ุจุฅูุบุงุก ุงูุชุนููู ุนูู ูุฐู ุงูุฃุณุทุฑ:

```javascript
const serviceAccount = require('./serviceAccountKey.json');

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});
```

### ุงูุฎุทูุฉ 4: ุชุดุบูู ุงูุณูุฑูุจุช

```bash
node scripts/update-products-with-subcategory-id.js
```

## ๐ ูุง ุงูุฐู ููุนูู ุงูุณูุฑูุจุชุ

### 1. ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช

ูุจู ุงูุจุฏุกุ ูุนุฑุถ ุงูุณูุฑูุจุช ุฅุญุตุงุฆูุงุช ุงูููุชุฌุงุช:

```
๐ ุฅุญุตุงุฆูุงุช ุงูููุชุฌุงุช:
==================================================
ุฅุฌูุงูู ุงูููุชุฌุงุช: 4362
ูุฏููู subcategoryId: 0
ุจุฏูู subcategoryId: 4362
ูุฏููู categoryId: 4362
ูุฏููู subcategoryName: 4362
==================================================
```

### 2. ุจูุงุก ุฎุฑูุทุฉ ุงููุฆุงุช ุงููุฑุนูุฉ

ูููู ุงูุณูุฑูุจุช ุจุจูุงุก ุฎุฑูุทุฉ (Map) ุชุฑุจุท ุจูู:
- `categoryId` + `subcategoryName` โ `subcategoryId`

ูุซุงู:
```
2qhztjWrtdHZBl9BFtTo:ุญูุงุฆุจ ูุฅูุณุณูุงุฑุงุช โ GXakfwzrVqoStlGav7gR
2qhztjWrtdHZBl9BFtTo:Bags & Accessories โ GXakfwzrVqoStlGav7gR
```

### 3. ุชุญุฏูุซ ุงูููุชุฌุงุช

ููู ููุชุฌ:
1. ูุชุญูู ูู ูุฌูุฏ `subcategoryId` (ูุชุฎุทู ุงูููุชุฌุงุช ุงูุชู ูุฏููุง ุจุงููุนู)
2. ูุจุญุซ ุนู `subcategoryId` ุงูููุงุณุจ ุจูุงุกู ุนูู `categoryId` ู `subcategoryName`
3. ูุถูู ุญูู `subcategoryId` ููููุชุฌ
4. ูุญุฏุซ `updatedAt` timestamp

### 4. ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

```
๐ ููุฎุต ุงูุชุญุฏูุซ:
==================================================
โ ุชู ุชุญุฏูุซ: 4362 ููุชุฌ
โญ๏ธ  ุชู ุชุฎุทู: 0 ููุชุฌ (ูุฏููู subcategoryId ุจุงููุนู)
โ ุฃุฎุทุงุก: 0 ููุชุฌ
==================================================
```

## ๐ ููุงุญุธุงุช ูููุฉ

### Batch Size
ุงูุณูุฑูุจุช ูุณุชุฎุฏู Firestore batches ูุชุญุณูู ุงูุฃุฏุงุก:
- ูู batch ูุญุชูู ุนูู 500 ููุชุฌ ูุญุฏ ุฃูุตู
- ูุชู ุญูุธ ูู batch ุนูู ุญุฏุฉ

### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
ุงูุณูุฑูุจุช ูุชุนุงูู ูุน:
- ุงูููุชุฌุงุช ุจุฏูู `categoryId` ุฃู `subcategoryName` (ูุชุฎุทุงูุง)
- ุงูููุชุฌุงุช ุงูุชู ูุง ูููู ุฅูุฌุงุฏ `subcategoryId` ููุง (ูุณุฌู ุชุญุฐูุฑ)

## ๐ง ุงูุทุฑููุฉ 2: ุชุญุฏูุซ ูุฏูู (ููุฃุนุฏุงุฏ ุงูููููุฉ)

ุฅุฐุง ูุงู ูุฏูู ุนุฏุฏ ูููู ูู ุงูููุชุฌุงุชุ ููููู ุชุญุฏูุซูุง ูุฏููุงู:

### 1. ุงูุชุญ Firebase Console
### 2. ุงุฐูุจ ุฅูู Firestore โ products
### 3. ุงูุชุญ ุฃู ููุชุฌ
### 4. ุงููุฑ ุนูู "Add field"
### 5. ุฃุถู:
```
Field: subcategoryId
Type: string
Value: GXakfwzrVqoStlGav7gR (ุงูุณุฎ ูู ุงููุฆุฉ ุงููุฑุนูุฉ)
```

## ๐ฏ ุจุนุฏ ุงูุชุญุฏูุซ

### 1. ุชุญูู ูู ุงููุชุงุฆุฌ
ุงูุชุญ ุงูุชุทุจูู ูุชุฃูุฏ ูู:
- โ ุงูููุชุฌุงุช ุชุธูุฑ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
- โ ุงูููุชุฌุงุช ุชุธูุฑ ุนูุฏ ุงุฎุชูุงุฑ ูุฆุฉ ูุฑุนูุฉ
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู Console

### 2. ุฑุงูุจ Firebase Console
ุงูุชุญ ุฃู ููุชุฌ ูุชุฃูุฏ ูู ูุฌูุฏ:
```json
{
  "categoryId": "2qhztjWrtdHZBl9BFtTo",
  "subcategoryId": "GXakfwzrVqoStlGav7gR",
  "subcategoryName": "ุญูุงุฆุจ ูุฅูุณุณูุงุฑุงุช",
  ...
}
```

## โ ุญู ุงููุดุงูู

### ูุดููุฉ: "Error: Cannot read property 'subcategory' of undefined"
**ุงูุณุจุจ:** ุงููุฆุฉ ุงูุฑุฆูุณูุฉ ุบูุฑ ููุฌูุฏุฉ ุฃู ุชู ุญุฐููุง

**ุงูุญู:**
1. ุชุญูู ูู ุฃู ุฌููุน `categoryId` ูู ุงูููุชุฌุงุช ููุฌูุฏุฉ ูู `categories` collection
2. ูู ุจุญุฐู ุฃู ุชุนุฏูู ุงูููุชุฌุงุช ุงูุชู ูุฏููุง `categoryId` ุบูุฑ ุตุญูุญ

### ูุดููุฉ: "Warning: ูู ูุชู ุงูุนุซูุฑ ุนูู subcategoryId"
**ุงูุณุจุจ:** ุงุณู ุงููุฆุฉ ุงููุฑุนูุฉ ูู ุงูููุชุฌ ูุง ูุทุงุจู ุฃู ูุฆุฉ ูุฑุนูุฉ

**ุงูุญู:**
1. ุชุญูู ูู ูุชุงุจุฉ `subcategoryName` ูู ุงูููุชุฌ
2. ุชุญูู ูู ุฃู ุงููุฆุฉ ุงููุฑุนูุฉ ููุฌูุฏุฉ ูู `categories/{categoryId}/subcategory`
3. ุชุฃูุฏ ูู ุฃู ุงูุฃุณูุงุก ูุชุทุงุจูุฉ ุชูุงูุงู (case-sensitive)

### ูุดููุฉ: "Permission denied"
**ุงูุณุจุจ:** ููุณ ูุฏูู ุตูุงุญูุงุช ูุงููุฉ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู Service Account Key ุตุญูุญ
- ุชุฃูุฏ ูู ุฃู ุงูู Service Account ูุฏูู ุตูุงุญูุฉ "Firebase Admin SDK Administrator Service Agent"

## ๐ ุงููุตุงุฏุฑ

- [Firebase Admin SDK](https://firebase.google.com/docs/admin/setup)
- [Firestore Batch Writes](https://firebase.google.com/docs/firestore/manage-data/transactions)
- [ุฏููู ุจููุฉ ุงูููุชุฌุงุช](./PRODUCTS_STRUCTURE_GUIDE.md)

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2 ููููุจุฑ 2025
